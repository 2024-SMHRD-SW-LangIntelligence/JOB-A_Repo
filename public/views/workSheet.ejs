<%- contentFor('body') %>
<style>
    #calendar{
        height: 700px;
    }

    #addEventForm {
            height: 638px; /* 일정 추가 폼의 높이 조정 */
            overflow-y: auto; /* 폼이 넘칠 경우 스크롤바 표시 */
            padding: 20px; /* 내용과 폼의 여백 설정 */
            background-color: #f8f9fa; /* 배경색 설정 */
            border: 1px solid #ced4da; /* 테두리 설정 */
            border-radius: 8px; /* 모서리 둥글게 */
            margin-top: 25px;
    }
    .col-md-8{
        margin-top: 15px;
    }
    .fc-col-header-cell-cushion {
        color: rgb(0, 0, 0);
    }

    .fc-daygrid-event.fc-daygrid-dot-event.fc-event.fc-event-start.fc-event-end.fc-event-today {
        color: rgb(0, 0, 0);
    }

</style>


    <!-- Page Heading -->

    <div class="container mt-5">
        <div class="row">
            <div class="col-md-4">
                <div id='calendar'></div>
            </div>
            <div class="col-md-8">
                <h3>일정 추가</h3>
                <form id="addEventForm">
                    <div class="mb-3">
                        <label for="eventTitleInput" class="form-label">제목</label>
                        <input type="text" class="form-control" id="eventTitleInput" required>
                    </div>
                    <div class="mb-3">
                        <label for="eventDescriptionInput" class="form-label">설명</label>
                        <textarea class="form-control" id="eventDescriptionInput"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="eventStartInput" class="form-label">시작 시간</label>
                        <input type="datetime-local" class="form-control" id="eventStartInput" required>
                    </div>
                    <div class="mb-3">
                        <label for="eventEndInput" class="form-label">종료 시간</label>
                        <input type="datetime-local" class="form-control" id="eventEndInput" required>
                    </div>
                    <button type="submit" class="btn btn-primary">일정 추가</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Bootstrap Modal -->
    <div class="modal fade" id="eventModal" tabindex="-1" aria-labelledby="eventModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="eventModalLabel">일정 상세 정보</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="eventTitleDisplay"></div>
                    <div id="eventDescriptionDisplay"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" id="deleteEventBtn">일정 삭제</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var calendarEl = document.getElementById('calendar');
            var calendar = new FullCalendar.Calendar(calendarEl, {
                locale: 'ko',
                initialView: 'dayGridDay',
                headerToolbar: {
                    left: 'prev,next today',
                    right: 'title'
                },
                events: [], // 일정을 담는 배열
                eventClick: function (info) {
                    // 일정 클릭 시 모달에 정보 표시
                    var modalTitle = document.getElementById('eventModalLabel');
                    var modalBody = document.querySelector('#eventModal .modal-body');

                    modalTitle.textContent = info.event.title; // 일정 제목
                    modalBody.innerHTML = ''; // 모달 바디 초기화

                    // 일정 정보 추가
                    var eventDescription = document.createElement('p');
                    eventDescription.textContent = info.event.extendedProps.description || '';
                    modalBody.appendChild(eventDescription);

                    // 모달 열기
                    var modal = new bootstrap.Modal(document.getElementById('eventModal'), {
                        keyboard: false
                    });
                    modal.show();

                    // 일정 삭제 버튼 클릭 시
                    var deleteEventBtn = document.getElementById('deleteEventBtn');
                    deleteEventBtn.addEventListener('click', function () {
                        if (confirm('정말로 이 일정을 삭제하시겠습니까?')) {
                            info.event.remove(); // 캘린더에서 이벤트 삭제
                            modal.hide(); // 모달 닫기
                        }
                    });
                }
            });

            calendar.render();

            // 일정 추가 폼 submit 처리
            var addEventForm = document.getElementById('addEventForm');
            addEventForm.addEventListener('submit', function (e) {
                e.preventDefault();

                var eventTitle = document.getElementById('eventTitleInput').value;
                var eventDescription = document.getElementById('eventDescriptionInput').value;
                var eventStart = document.getElementById('eventStartInput').value;
                var eventEnd = document.getElementById('eventEndInput').value;

                // 새로운 이벤트 객체 생성
                var newEvent = {
                    title: eventTitle,
                    start: eventStart,
                    end: eventEnd,
                    description: eventDescription
                };

                // 캘린더에 이벤트 추가
                calendar.addEvent(newEvent);

                // 모달 닫기
                var modal = bootstrap.Modal.getInstance(document.getElementById('eventModal'));
                modal.hide();

                // 폼 초기화
                addEventForm.reset();

                // datetime-local 입력 필드 초기화
                document.getElementById('eventStartInput').value = null;
                document.getElementById('eventEndInput').value = null;
            });
        });


    </script>