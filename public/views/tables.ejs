<!-- Page Heading -->
<h1 class="h3 mb-2 text-gray-800">내 정보</h1>
<link rel="stylesheet" href="../css/myInfo.css">

<style>
    .swal2-front {
        z-index: 1100 !important;
    }
</style>
<style>
    .text_1 {
        display: none;
        border: none;
        padding: 10px 5px;
        border-radius: 10px;
        background-color: #212529;
        width: 100%;
        color: white;
        margin-bottom: 10px;
    }
    .text_2 {
        display: none;
        border: none;
        padding: 10px 5px;
        border-radius: 10px;
        background-color: #212529;
        width: 100%;
        color: white;
        margin-bottom: 10px;
    }
</style>
<script>
    function handleSelectChange(selectElement) {
        var otherInput = document.getElementById('otherInput');
        if (selectElement.value === 'option') {  // '기타' 옵션 선택 시
            otherInput.style.display = 'block';
            otherInput.name = "certi_name";  // input 필드에 name 속성 추가
        } else {
            otherInput.style.display = 'none';
            otherInput.name = "";  // 기타 옵션이 아닌 경우 name 속성 제거
        }
    }
    function handleSelectChange2(selectElement) {
        var otherInput = document.getElementById('otherInput2');
        if (selectElement.value === 'option') {  // '기타' 옵션 선택 시
            otherInput.style.display = 'block';
            otherInput.name = "certi_name";  // input 필드에 name 속성 추가
        } else {
            otherInput.style.display = 'none';
            otherInput.name = "";  // 기타 옵션이 아닌 경우 name 속성 제거
        }
    }
</script>
<script>
    document.addEventListener('DOMContentLoaded', (event) => {
            const openModalBtn = document.querySelector('.certi_open_modal');
            const closeModalBtn = document.querySelector('.certi_close_modal');
            const modal = document.querySelector('.certi_modal');
            const bluu = document.querySelector('.bluu');
        
            openModalBtn.addEventListener("click", () => {
                modal.style.display = "block";
                bluu.style.display = "block";
            });
        
            closeModalBtn.addEventListener("click", () => {
                modal.style.display = "none";
                bluu.style.display = "none";
            });
        });
</script>


<!-- ----------------------------------------------------- 자격증 모달----------------------------------------------------- -->
<div>
    <div class="certi_modal">
    <div class="modal_body">
        <button class="certi_close_modal">x</button> <!-- 닫기 버튼 -->
        <form action="/certi/add" method="post" id="cform">
            <label><h4>보유 자격증 입력</h4></label>
            <div class="sign-in-htm">
                <!-- 자격명 입력 -->
                <div>
                    <!-- <input id="cname" name="certi_name" type="text"
                        class="inputStyle" placeholder="자격명을 입력하세요." required> -->
                        <select id="cname" name="certi_name" class="inputStyle" onchange="handleSelectChange(this)">
                            <option value="option">기타</option>
                            <% for(let i = 1; i <= 30; i++) { %> 
                                <option placeholder="자격명을 입력하세요." value="option<%= i %>">Option <%= i %></option> user
                            <% } %>
                        </select>
                        <input type="text" id="otherInput" class="text_1" placeholder="자격명을 입력하세요.">
                </div>
                <!-- 자격증 취득일자 입력 -->
                <div>
                    <input id="cdate" name="certified_at" type="date"
                        class="inputStyle" placeholder="자격증 취득일자를 입력하세요." required>
                </div> <% %>
                <!-- 발행기관 입력 -->
                <div>
                        <select id="corg" name="certi_org" class="inputStyle" onchange="handleSelectChange2(this)">
                            <option value="option">기타</option>
                            <% for(let i = 1; i <= 30; i++) { %>
                                <option placeholder="발행기관을 입력하세요." value="option<%= i %>">Option <%= i %></option> user
                            <% } %>
                        </select>
                        <input type="text" id="otherInput2" class="text_2" placeholder="발행기관을 입력하세요."">
                </div>
                <!-- 입력 버튼 -->
                <div id="login_btn">
                    <button type="submit" value="Sign In">입력</button>
                </div>
            </div>
        </form>
    </div>
</div>
</div>
<button class="certi_open_modal">자격증 입력</button>

<div class="div_style"> <!-- 가로로 정렬해줌 -->
    <!-- ---------------------------------------------- 일정 수행률 ----------------------------------- -->
    <div class="block_style">
        <div class="block_detail">
            <div class="card_style-body">
                <div class="block_text">
                        <div class="block1_text_color">일정 수행률</div>
                        <div class="col-auto">
                            <div class="block2_text_color">100%</div>
                        <div class="row no-gutters align-items-center">
                            
                            <div class="col">
                                <div class="percent_stick"> <!-- style 100%를  msche_status value개수 총합(일정 상태가 성공인것과, 실패인것 취합)/msche_status(성공한수)-->
                                    <div class="percent" role="progressbar"
                                        
                                        aria-valuenow="50" aria-valuemin="0"
                                        aria-valuemax="100"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>

    <!-- ---------------------------------- 자격증수 ------------------------------- -->
    <div class="block_style">
        <div class="block_detail">
            <div class="card_style-body">
                <div class="block_text">
                        <div class="block1_text_color">자격증수</div>
                        <div class="block2_text_color"><p id="certi_cut"></div> <!-- 자격증 개수 넣는곳 -->
                </div>
            </div>
        </div>
    </div>
    
        <!-- ----------------------------------------- 파이 차트 ---------------------------------- -->
    <div class="chart_style">
        <div class="card shadow mb-4">
            <!-- Card Header - Dropdown -->
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Donut Chart</h6>
            </div>
            <!-- Card Body -->
            <div class="card-body">
                <div class="chart-pie pt-4">
                    <canvas id="myPieChart"></canvas>
                </div>
                <hr>설명
            </div>
        </div>
    </div>
    <!-- ------------------------------------- 자격증 테이블 보여주기 ------------------------------------ -->
    <div class="chart_style">
        <div class="card shadow mb-4">
            <!-- Card Header - Dropdown -->
            <div class="card-header py-3" id="data-table tbody">
                <h6 class="m-0 font-weight-bold text-primary" >Donut Chart</h6>
            </div>
            <!-- Card Body -->
            <div class="card-body">
                <div class="chart-pie pt-4">
                    <table>
                            <div class="certificate">
                                <th id="certificate-list"></th>
                            </div>
                    </table>
                </div>
                <hr>설명
            </div>
        </div>
    </div>

    <!------------------------------------------------------------------------------------------ 스크립트 -------------------------------------------------------------------->
    <script>
        // ----------------------------- 일정 성취률 가져오기----------------------------------
        $(document).ready(function() {
            fetchCertificates(); // 페이지 로드 시 자동으로 데이터 가져오기

            function fetchCertificates() {
                $.ajax({
                    url: '/certi/schedule', // 경로
                    type: 'GET',
                    success: function(scheduleC) {
                        console.log('scheduleC:', scheduleC);
                        countsusses(scheduleC);
                    },
                    error: function(error) {
                        console.error('Error fetching data:', error);
                    }
                });
            }
            //  ---------------------------------------백분율 구해서 스타일에 %로 보내기---------------------------------------------------------------------
            function countsusses(scheduleC) {
                const certificateList = $('#certificate-list');         // certificate-list 라는 id를 가지면
                certificateList.empty();
                const good = 0;                                         // 성공 갯수 세기
                scheduleC.forEach(function(scheduleC) {
                    if(scheduleC.msche_status==1){
                        good += 1;
                    }
                    const total = scheduleC.length;                     // 총 일정 수
                    const percentage = good/total;                      // 백분율

                    const percentElement = $('#percent');
                    percentElement.css('width', `${percentage}%`);      // 스타일에 넣어서 시각화
                });
            }
        });
        // ---------------------------------------------------끝-----------------------------------------------------------




    // ---------------------------------------자격증 테이블 데이터 가져오기---------------------------------------------------
        $(document).ready(function() {
            fetchCertificates(); // 페이지 로드 시 자동으로 데이터 가져오기

            function fetchCertificates() {
                $.ajax({
                    url: '/certi/select_certi', // 경로
                    type: 'GET',
                    success: function(certificates) {
                        console.log('Certificates:', certificates);
                        displayCertificates(certificates);
                        certi_count(certificates);
                    },
                    error: function(error) {
                        console.error('Error fetching data:', error);
                    }
                });
            }
            // ---------------------------------------------자격증 테이블------------------------------------------------------
            function displayCertificates(certificates) {
                const certificateList = $('#certificate-list');         // certificate-list 라는 id를 가지면
                certificateList.empty();
                let certi_cnt = console.log(certificateList.length)+1; 
                certificates.forEach(function(certificate) {            // 아래 구문 생성(자격명, 취득일자, 발행기관)
                    const certElement = `
                    
                        <tr>
                        <th>자격명: ${certificate.certi_name}</th>
                        <th>취득일자: ${certificate.certified_at}</th>
                        <th>발행기관: ${certificate.certi_org}</th>
                        </tr>
                    `;
                    certificateList.append(certElement);
                });
            }

            // ---------------------------------------자격증 수---------------------------------------------------
            function certi_count(certificates) {
                const certificateList = $('#certi_cut');
                certificateList.empty();
                let certi_cnt = certificates.length;
                const certCountElement = `<p>  ${certi_cnt}</p>`;
                certificateList.append(certCountElement);
            }
        });
        // --------------------------------------------- 끝 ------------------------------------------------------
    </script>
    


